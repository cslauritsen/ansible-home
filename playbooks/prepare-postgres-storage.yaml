---
- name: Prepare nodes for PostgreSQL local storage
  hosts: k8snodes
  become: yes
  tasks:
    - name: Create PostgreSQL data directories
      file:
        path: "/data/postgres/{{ inventory_hostname }}"
        state: directory
        mode: '0750'
        owner: 26  # PostgreSQL UID
        group: 26  # PostgreSQL GID

    - name: Create PostgreSQL WAL directories
      file:
        path: "/data/postgres-wal/{{ inventory_hostname }}"
        state: directory
        mode: '0750'
        owner: 26  # PostgreSQL UID
        group: 26  # PostgreSQL GID

    - name: Verify directory permissions
      command: ls -la /data
      register: data_dir_listing
      changed_when: false

    - name: Display directory listing
      debug:
        var: data_dir_listing.stdout_lines

